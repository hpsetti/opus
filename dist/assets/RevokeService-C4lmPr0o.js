import{g as b,_ as T,$ as U,c as l,a as e,b as k,w as W,j as g,v as D,k as p,n as A,F as x,m as w,e as m,t as h,r as P,o,Y as K,q as C,p as F,f as V}from"./index-BlMJxPGQ.js";import{a as E}from"./debounce-DQE7iwz8.js";import{L as O}from"./Loader-DR0R9oEF.js";import{D as j,_ as N}from"./new_search-CVeFIShG.js";import{_ as B}from"./chevron_left_icon-6Fqv5UkY.js";import{_ as R}from"./danger_close_icon-CkTgh2bE.js";async function M(t){const s={searchBy:t};let c="";return await b.get("https://backend.opus.emergobyul.com/services/launchpad/admin/search",{params:s}).then(i=>{i.status===200&&i.data&&(c=i.data.data)}).catch(i=>{console.log("get account data api error",i)}),c}async function q(t){let s={};const c={userId:t};return await b.get("https://backend.opus.emergobyul.com/services/launchpad/admin/allPurchasedServices",{params:c}).then(i=>{i.status===200&&i.data&&(s=i.data.data)}).catch(i=>console.log("get Available Services  in Admin API error",i)),s}async function z(t){let s={};const c={account_ids:[t]};return await b.delete("https://backend.opus.emergobyul.com/services/activity/tracker/deactivate/account",{data:c}).then(i=>{i.status===200&&i.data&&(s=i.data)}).catch(i=>console.log("get Available Services  in Admin API error",i)),s}async function Y(t){let s={};return await b.post("https://backend.opus.emergobyul.com/services/launchpad/admin/revokePlans",t).then(c=>{c.status===200&&c.data&&(s=c.data)}).catch(c=>{console.log("Activate Plans API  in Admin API error",c),s=c.response.data}),s}const G={data(){return{isIltWithoutDates:!1,loaderStatus:!1,searchKeyword:"",plansList:{},usersList:[],userDetails:{},selectedUser:null,isUsersListEmpty:!1,isSelectAll:!1,selectedPlanIdsWithType:{},planSelected:"",availableActions:{plans:"Purchased plans"},formDetails:{account_owner_id:"",comments:"",invoice:"",purchase_order:"",payment_mode:null,plan_price:0},paymentOptions:[{id:2,name:"Invoice"},{id:3,name:"Purchase Order"},{id:4,name:"Others"}]}},components:{DeactivateUserPopup:j,Loader:O},computed:{isDisabled(){return!Object.values(this.selectedPlanIdsWithType).some(s=>!!s.length)}},watch:{searchKeyword(){this.searchKeyword.length<2&&this.usersList.length&&(this.usersList=[])}},methods:{resetSearchKeyword(){this.searchKeyword=""},navigateToLaunchPad(){this.$router.push("/launchpad")},async deactivateUser(){U("#deactivateUserPopup").modal("hide"),this.loaderStatus=!0;const t=await z(this.userDetails.account_id);this.loaderStatus=!1,this.showToaster(t)},showToaster(t){t.status_code===200?(this.$notify({type:"success",title:"Success",text:t.data}),this.userDetails={},this.resetAll()):this.$notify({type:"error",title:"Error",text:t.message||"Please try again later"})},openDeActiveUserPopup(){U("#deactivateUserPopup").modal({backdrop:"static",keyboard:!1})},async activateServices(){this.loaderStatus=!0;const t=Object.keys(this.selectedPlanIdsWithType).reduce((i,a)=>{if(this.selectedPlanIdsWithType[a].length){if(a==="ILT"){const v=this.selectedPlanIdsWithType[a].map(S=>({plan_id:S}));return i=[...i,...v],i}const r=this.selectedPlanIdsWithType[a].map(v=>({plan_id:v}));return i=[...i,...r],i}return i},[]),s={...this.formDetails,account_owner_id:+this.formDetails.account_owner_id,plan_price:+this.formDetails.plan_price,plan_info_list:t,account_id:this.userDetails.account_id,user_id:this.userDetails.user_id,payment_mode:5},c=await Y(s);this.loaderStatus=!1,this.showToaster(c)},getSlotTimeWithPlanIds(){var t,s;return(t=this.selectedPlanIdsWithType.ILT)!=null&&t.length?(s=this.plansList)==null?void 0:s.ILT.reduce((c,i)=>(i.available_time_slot&&(c[i.plan_id]=i.available_time_slot.slot_id),c),{}):{}},async setAccountFieldValues(t){this.searchKeyword=t.user_id,this.usersList=[],this.selectedUser=t,this.isUsersListEmpty=!1,this.getAvailableServiceForUser()},onSelectAll(t,s=[]){this.isSelectAll?this.selectedPlanIdsWithType[t]=s.map(c=>c.plan_id):this.selectedPlanIdsWithType[t]=[]},onPlanChange(t,s=[]){t==="ILT"&&(this.isSelectAll=this.selectedPlanIdsWithType[t].length===s.length)},resetAll(){this.planSelected="",this.isSelectAll=!1,this.searchKeyword="",this.selectedUser=null,this.formDetails={account_owner_id:"",comments:"",invoice:"",purchase_order:"",payment_mode:null,plan_price:0},this.setPlanIdWithTypes()},async getAvailableServiceForUser(){var t;this.loaderStatus=!0,this.plansList=await q(this.selectedUser.user_id),this.isIltWithoutDates=(t=this.plansList.ILT)==null?void 0:t.find(s=>!s.available_time_slot),this.setPlanIdWithTypes(),this.userDetails=this.selectedUser,this.resetAll(),this.loaderStatus=!1},setPlanIdWithTypes(){this.selectedPlanIdsWithType=Object.keys(this.plansList).reduce((t,s)=>(t[s]=[],t),{})},getAccountsListForAccountSearch:E(async function(){this.searchKeyword.length>1&&(this.selectedUser&&(this.selectedUser=null),this.usersList=await M(this.searchKeyword),this.isUsersListEmpty=!this.usersList.length)},200)}},d=t=>(F("data-v-d8d0dda5"),t=t(),V(),t),H={class:"content-wrappper"},J={class:"col-xs-12 mt-20 p-0 search-wrapper"},Q={class:"col-xs-12 search-header"},X={class:"col-xs-12 mb-10 d-flex align-items-center col-gap-10 mb-20"},Z=d(()=>e("div",{class:"col-xs-12 text-primary fw-300 header-text mb-10"}," Locate OPUS User by searching the User ID or Email ID ",-1)),$={class:"col-xs-12"},ee={class:"col-xs-12 col-sm-5 p-0"},se=d(()=>e("span",{class:"vertical-line"},null,-1)),te=d(()=>e("img",{src:N,alt:"search-icon"},null,-1)),ae=[te],ie={key:0,class:"col-xs-12 no-data-text font-18 fw-700"},le={key:1,class:"col-xs-12 no-data-text font-18 fw-700"},oe={key:2,class:"col-xs-12 p-0 custom-col-search"},ce=["onClick"],ne={key:0,class:"col-xs-12 p-0 no-data-text font-18 fw-700 text-center"},re={key:0,class:"col-xs-12 mt-20"},de={class:"col-xs-12"},he=d(()=>e("h4",{class:"fw-700 font-18 text-primary"},"User Details",-1)),ue={class:"ml-30 mr-30"},_e={class:"col-xs-12"},pe=d(()=>e("span",{class:"fw-600"},"User Name: ",-1)),me={class:"col-xs-12"},ve=d(()=>e("span",{class:"fw-600"},"User Id: ",-1)),ye={class:"col-xs-12"},fe=d(()=>e("span",{class:"fw-600"},"Email: ",-1)),ge={class:"col-xs-12"},xe=d(()=>e("span",{class:"fw-600"},"Account Id: ",-1)),we={key:0,class:"col-xs-12 d-flex"},be=d(()=>e("span",{class:"fw-600"},"Account status: ",-1)),Se=d(()=>e("p",{class:"green-main pl-10"},"Active",-1)),ke=[be,Se],Ae={key:1,class:"col-xs-12 d-flex"},Pe=d(()=>e("span",{class:"fw-600"},"Account status: ",-1)),Ie=d(()=>e("p",{class:"red-1 pl-10"},"InActive",-1)),Ue=[Pe,Ie],De={key:0},Le={class:"col-xs-12 p-0"},Te={class:"radio"},We=["value"],Ke=d(()=>e("div",{class:"radio__radio"},null,-1)),Ce={class:"fw-700 font-18 text-primary"},Fe={key:0,class:"required-asterisk"},Ve={key:0,class:"d-flex flex-direction-column plans-wrapper"},Ee={class:"panel-group",id:"plans-accordion"},Oe={class:"panel-heading"},je=["data-target"],Ne=["id"],Be={class:"panel-body"},Re={key:0,class:"col-xs-12"},Me={class:"select-box"},qe={class:"checkbox"},ze=["value","onUpdate:modelValue","onChange"],Ye=d(()=>e("span",{class:"cr"},[e("i",{class:"cr-icon glyphicon glyphicon-ok"})],-1)),Ge={key:1,class:"col-xs-12 p-0 no-data-text font-18 fw-700 text-center"},He={class:"col-xs-12"},Je={class:"col-xs-12 col-sm-4"},Qe=d(()=>e("label",null,"Comments",-1)),Xe={class:"col-xs-12 mt-20 pl-30 mb-30"},Ze=["disabled"];function $e(t,s,c,i,a,r){const v=P("router-link"),S=P("loader"),L=P("deactivate-user-popup");return o(),l("div",H,[e("div",J,[e("div",Q,[e("div",X,[e("img",{onClick:s[0]||(s[0]=(...n)=>r.navigateToLaunchPad&&r.navigateToLaunchPad(...n)),class:"back-img cursor-pointer",src:B,alt:""}),k(v,{class:"tools-text font-18",to:"/launchpad"},{default:W(()=>[m("Service Revoke")]),_:1})]),Z,e("div",$,[e("div",ee,[g(e("input",{class:"search-box form-control mb-20 font-16",type:"text","onUpdate:modelValue":s[1]||(s[1]=n=>a.searchKeyword=n),placeholder:"Search",onKeyup:s[2]||(s[2]=(...n)=>r.getAccountsListForAccountSearch&&r.getAccountsListForAccountSearch(...n))},null,544),[[D,a.searchKeyword,void 0,{trim:!0}]]),e("div",null,[a.searchKeyword?(o(),l("img",{key:0,onClick:s[3]||(s[3]=(...n)=>r.resetSearchKeyword&&r.resetSearchKeyword(...n)),src:R,alt:"close-icon",class:"cursor-pointer search-reset"})):p("",!0),se,e("span",{onClick:s[4]||(s[4]=n=>r.getAvailableServiceForUser()),class:A(["search-icon cursor-pointer",{"events-none":!a.selectedUser}])},ae,2)]),a.searchKeyword&&a.searchKeyword.length<2?(o(),l("div",ie," Please enter at least 2 characters ")):a.isUsersListEmpty&&a.searchKeyword.length>=2?(o(),l("div",le," No Users Found ")):a.usersList.length?(o(),l("div",oe,[e("ul",null,[(o(!0),l(x,null,w(a.usersList,(n,y)=>(o(),l("li",{key:y,onClick:_=>r.setAccountFieldValues(n)},h(n.user_name)+" - ID "+h(n.user_id),9,ce))),128))])])):p("",!0)]),!Object.keys(a.userDetails).length&&!a.searchKeyword?(o(),l("div",ne," Please search the user by entering the username or user id ")):p("",!0)])]),Object.keys(a.userDetails).length?(o(),l("div",re,[e("div",de,[he,e("div",ue,[e("div",_e,[pe,m(h(a.userDetails.user_name),1)]),e("div",me,[ve,m(h(a.userDetails.user_id),1)]),e("div",ye,[fe,m(h(a.userDetails.email),1)]),e("div",ge,[xe,m(h(a.userDetails.account_id),1)]),a.userDetails.active?(o(),l("div",we,ke)):(o(),l("div",Ae,Ue))])]),a.userDetails.active?(o(),l("div",De,[(o(!0),l(x,null,w(a.availableActions,(n,y)=>(o(),l("div",{class:"col-xs-12 mt-30",key:y},[e("div",Le,[e("label",Te,[g(e("input",{type:"radio",class:"radio__input",value:y,"onUpdate:modelValue":s[5]||(s[5]=_=>a.planSelected=_)},null,8,We),[[K,a.planSelected]]),Ke,e("div",Ce,[m(h(n)+" ",1),n==="Purchased plans"?(o(),l("span",Fe,"*")):p("",!0)])])]),a.planSelected==="plans"&&y==="plans"?(o(),l("div",Ve,[e("div",Ee,[(o(!0),l(x,null,w(a.plansList,(_,u)=>(o(),l("div",{class:"panel wrapper-panel",key:u},[e("div",Oe,[e("div",{class:"panel-title cursor-pointer collapsed","data-toggle":"collapse","data-parent":"#plans-accordion","data-target":`#plan${u.replaceAll(" ","-")}`},h(u),9,je)]),e("div",{id:`plan${u.replaceAll(" ","-")}`,class:"panel-collapse collapse"},[e("div",Be,[_&&_.length?(o(),l("div",Re,[(o(!0),l(x,null,w(_,f=>(o(),l("div",{class:"col-xs-12 d-flex align-items-center col-gap-10",key:f.plan_id},[e("div",Me,[e("div",qe,[e("label",null,[g(e("input",{type:"checkbox",value:f.plan_id,"onUpdate:modelValue":I=>a.selectedPlanIdsWithType[u]=I,onChange:I=>r.onPlanChange(u,_)},null,40,ze),[[C,a.selectedPlanIdsWithType[u]]]),Ye])])]),e("div",{class:A(["text-primary",{"fw-700":a.selectedPlanIdsWithType[u].includes(f.plan_id)}])},h(f.item_name),3)]))),128))])):(o(),l("div",Ge," User currently have not purchased any resources "))])],8,Ne)]))),128))])])):p("",!0)]))),128)),e("div",He,[e("div",Je,[Qe,g(e("textarea",{maxlength:"1500",type:"text",class:"form-control",rows:"5","onUpdate:modelValue":s[6]||(s[6]=n=>a.formDetails.comments=n)},null,512),[[D,a.formDetails.comments,void 0,{trim:!0}]])])]),e("div",Xe,[e("button",{onClick:s[7]||(s[7]=(...n)=>r.activateServices&&r.activateServices(...n)),class:A([{"events-none":r.isDisabled},"emergo-green-button"]),disabled:r.isDisabled}," Revoke Plans ",10,Ze)])])):p("",!0)])):p("",!0),k(S,{loadingStatus:a.loaderStatus},null,8,["loadingStatus"]),k(L,{onDeActivateUserAccount:r.deactivateUser},null,8,["onDeActivateUserAccount"])])])}const os=T(G,[["render",$e],["__scopeId","data-v-d8d0dda5"]]);export{os as default};
