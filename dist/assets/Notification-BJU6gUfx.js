import"./event-bus-DYoA24Gz.js";import{L as p}from"./Loader-DR0R9oEF.js";import{l as y}from"./lodash-DhCEjwN-.js";import{d as b,b as L,c as P}from"./notification-3XJ3CcaQ.js";import{P as T}from"./Pagination-BZVaeVs8.js";import{N as I}from"./NotificationItem-DmIdwGA_.js";import{_ as N,o,c as n,a as g,F as S,m as k,b as c,I as C,k as _,r,B as O,w as R,e as E}from"./index-BlMJxPGQ.js";import{O as v}from"./OpusTabs-CHfUVHKr.js";import"./chevron_right-Bv87NFTl.js";import"./OpusTag-CYru5hFs.js";const x={name:"NotificationGeneral",props:{notificationsList:{type:Array,default:()=>[]},userId:{type:Number,required:!0},pageNo:{type:Number,default:1}},components:{Pagination:T,Loader:p,NotificationItem:I},data(){return{perPage:20,currentPage:1,filteredList:[],loaderStatus:!1}},computed:{totalPages(){return Math.ceil(this.notificationsList.length/this.perPage)}},watch:{notificationsList:{handler(){const t=this.pageNo>this.totalPages&&this.pageNo>1?this.totalPages:this.pageNo;this.setPage(t)},immediate:!0}},methods:{async dismiss(t){this.loaderStatus=!0;const e=await b(this.userId,t.id);e&&e.message==="success"?(this.$notify({type:"success",title:"Success",text:"Successfully deleted the notification"}),this.emitter.emit("get-notification-count"),this.$emit("refresh",{notification:t,pageNo:this.currentPage})):this.$notify({type:"error",title:"Error",text:"Unable to delete the notification"}),this.loaderStatus=!1},setPage(t){t<0&&t>this.totalPages||(this.currentPage=t,this.filteredList=y.cloneDeep(this.notificationsList.slice((t-1)*this.perPage,t*this.perPage)),console.log("this.notificationsList",this.notificationsList))}}},w={class:"notif-container"},G={key:0,class:"no-notifications"},A={key:1};function B(t,e,i,l,s,a){const d=r("NotificationItem"),h=r("Pagination"),f=r("loader");return o(),n("div",null,[g("div",w,[s.filteredList.length===0?(o(),n("div",G," You do not have any notifications ")):(o(),n("div",A,[(o(!0),n(S,null,k(s.filteredList,(u,m)=>(o(),n("div",{key:m},[c(d,{notification:u,onDismiss:q=>a.dismiss(u)},null,8,["notification","onDismiss"])]))),128))])),i.notificationsList.length>s.perPage?(o(),C(h,{key:2,perPage:s.perPage,totalPages:a.totalPages,total:i.notificationsList.length,currentPage:s.currentPage,onPagechanged:a.setPage},null,8,["perPage","totalPages","total","currentPage","onPagechanged"])):_("",!0)]),c(f,{loadingStatus:s.loaderStatus},null,8,["loadingStatus"])])}const U=N(x,[["render",B],["__scopeId","data-v-79087433"]]),D={name:"Notification",props:["userId"],components:{NotificationGeneral:U,Loader:p,BaseButton:O,OpusTabs:v},data(){return{selectedTab:"general",loaderStatus:!0,notificationsList:[],filteredList:[],tabs:null,types:{general:["Other"],hfe:["PROJECT"],trainings:["TRAINING","INSTRUCTOR_TRAINING","QNA_CONSULTING","INSTRUCTOR_PRE_RECORDED_TRAINING"],documents:["DOCUMENTS","USER_PROFILE_AND_ENVIRONMENT"],tools:["TOOLS"],consulting:["CONSULTING"]},pageNo:1}},async created(){this.loaderStatus=!0,this.resetTabs(),await this.getNotificationsList(),this.setTabCount(),this.loaderStatus=!1},computed:{hasNotifications(){return this.notificationsList.length>0}},watch:{selectedTab:{handler(){this.getFilteredList(),this.pageNo=1}}},methods:{async getNotificationsList(){this.loaderStatus=!0;const t=await L(this.userId);this.notificationsList=t.map(e=>(e.type==="QNA_CONSULTING"&&(e.type="INSTRUCTOR_TRAINING"),e)),this.getFilteredList(),this.loaderStatus=!1},setTabCount(){this.notificationsList.forEach(t=>{Object.keys(this.types).forEach(e=>{if(this.types[e].includes(t.type)){const i=this.tabs.findIndex(l=>l.key===e);i!==-1&&(this.tabs[i].count+=1)}})})},async refresh(t){this.loaderStatus=!0,Object.keys(this.types).forEach(e=>{if(this.types[e].includes(t.notification.type)){const i=this.tabs.findIndex(l=>l.key===e);i!==-1&&(this.tabs[i].count-=1),this.selectedTab=e}}),this.pageNo=t.pageNo,await this.getNotificationsList()},resetTabs(){this.tabs=[{name:"General",key:"general",count:0},{name:"HFE Process & Project Plans",key:"hfe",count:0},{name:"Trainings",key:"trainings",count:0},{name:"Documents",key:"documents",count:0},{name:"Tools",key:"tools",count:0},{name:"Consulting",key:"consulting",count:0}]},getFilteredList(){this.filteredList=this.notificationsList.filter(t=>this.types[this.selectedTab].includes(t.type))},async clearAll(){this.loaderStatus=!0;const t=await P(this.userId);t&&t.message==="success"?(this.$notify({type:"success",title:"Success",text:"Cleared all notifications"}),this.emitter.emit("get-notification-count")):this.$notify({type:"error",title:"Error",text:"Unable to clear all notifications"}),this.resetTabs(),await this.getNotificationsList(),this.setTabCount(),this.loaderStatus=!1}}},V={class:"content-wrappper"},F={key:0,class:"mt-20 mb-20"},j={class:"clear-all"},M={class:"tabs"};function Q(t,e,i,l,s,a){const d=r("BaseButton"),h=r("OpusTabs"),f=r("NotificationGeneral"),u=r("loader");return o(),n("div",V,[s.loaderStatus?_("",!0):(o(),n("div",F,[g("div",j,[c(d,{size:"lg",variant:"secondary",disabled:!a.hasNotifications,onClick:a.clearAll},{default:R(()=>[E("Clear all")]),_:1},8,["disabled","onClick"])]),g("div",M,[c(h,{tabs:s.tabs,showTabCount:"",modelValue:s.selectedTab,"onUpdate:modelValue":e[0]||(e[0]=m=>s.selectedTab=m)},null,8,["tabs","modelValue"])]),c(f,{userId:i.userId,notificationsList:s.filteredList,pageNo:s.pageNo,onRefresh:a.refresh},null,8,["userId","notificationsList","pageNo","onRefresh"])])),c(u,{loadingStatus:s.loaderStatus},null,8,["loadingStatus"])])}const et=N(D,[["render",Q],["__scopeId","data-v-cd6687f2"]]);export{et as default};
